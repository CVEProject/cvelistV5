{
    "dataType": "CVE_RECORD",
    "dataVersion": "5.2",
    "cveMetadata": {
        "cveId": "CVE-2025-68778",
        "assignerOrgId": "416baaa9-dc9f-4396-8d5f-8c081fb06d67",
        "state": "PUBLISHED",
        "assignerShortName": "Linux",
        "dateReserved": "2025-12-24T10:30:51.035Z",
        "datePublished": "2026-01-13T15:28:54.107Z",
        "dateUpdated": "2026-02-09T08:33:24.172Z"
    },
    "containers": {
        "cna": {
            "providerMetadata": {
                "orgId": "416baaa9-dc9f-4396-8d5f-8c081fb06d67",
                "shortName": "Linux",
                "dateUpdated": "2026-02-09T08:33:24.172Z"
            },
            "descriptions": [
                {
                    "lang": "en",
                    "value": "In the Linux kernel, the following vulnerability has been resolved:\n\nbtrfs: don't log conflicting inode if it's a dir moved in the current transaction\n\nWe can't log a conflicting inode if it's a directory and it was moved\nfrom one parent directory to another parent directory in the current\ntransaction, as this can result an attempt to have a directory with\ntwo hard links during log replay, one for the old parent directory and\nanother for the new parent directory.\n\nThe following scenario triggers that issue:\n\n1) We have directories \"dir1\" and \"dir2\" created in a past transaction.\n   Directory \"dir1\" has inode A as its parent directory;\n\n2) We move \"dir1\" to some other directory;\n\n3) We create a file with the name \"dir1\" in directory inode A;\n\n4) We fsync the new file. This results in logging the inode of the new file\n   and the inode for the directory \"dir1\" that was previously moved in the\n   current transaction. So the log tree has the INODE_REF item for the\n   new location of \"dir1\";\n\n5) We move the new file to some other directory. This results in updating\n   the log tree to included the new INODE_REF for the new location of the\n   file and removes the INODE_REF for the old location. This happens\n   during the rename when we call btrfs_log_new_name();\n\n6) We fsync the file, and that persists the log tree changes done in the\n   previous step (btrfs_log_new_name() only updates the log tree in\n   memory);\n\n7) We have a power failure;\n\n8) Next time the fs is mounted, log replay happens and when processing\n   the inode for directory \"dir1\" we find a new INODE_REF and add that\n   link, but we don't remove the old link of the inode since we have\n   not logged the old parent directory of the directory inode \"dir1\".\n\nAs a result after log replay finishes when we trigger writeback of the\nsubvolume tree's extent buffers, the tree check will detect that we have\na directory a hard link count of 2 and we get a mount failure.\nThe errors and stack traces reported in dmesg/syslog are like this:\n\n   [ 3845.729764] BTRFS info (device dm-0): start tree-log replay\n   [ 3845.730304] page: refcount:3 mapcount:0 mapping:000000005c8a3027 index:0x1d00 pfn:0x11510c\n   [ 3845.731236] memcg:ffff9264c02f4e00\n   [ 3845.731751] aops:btree_aops [btrfs] ino:1\n   [ 3845.732300] flags: 0x17fffc00000400a(uptodate|private|writeback|node=0|zone=2|lastcpupid=0x1ffff)\n   [ 3845.733346] raw: 017fffc00000400a 0000000000000000 dead000000000122 ffff9264d978aea8\n   [ 3845.734265] raw: 0000000000001d00 ffff92650e6d4738 00000003ffffffff ffff9264c02f4e00\n   [ 3845.735305] page dumped because: eb page dump\n   [ 3845.735981] BTRFS critical (device dm-0): corrupt leaf: root=5 block=30408704 slot=6 ino=257, invalid nlink: has 2 expect no more than 1 for dir\n   [ 3845.737786] BTRFS info (device dm-0): leaf 30408704 gen 10 total ptrs 17 free space 14881 owner 5\n   [ 3845.737789] BTRFS info (device dm-0): refs 4 lock_owner 0 current 30701\n   [ 3845.737792] \titem 0 key (256 INODE_ITEM 0) itemoff 16123 itemsize 160\n   [ 3845.737794] \t\tinode generation 3 transid 9 size 16 nbytes 16384\n   [ 3845.737795] \t\tblock group 0 mode 40755 links 1 uid 0 gid 0\n   [ 3845.737797] \t\trdev 0 sequence 2 flags 0x0\n   [ 3845.737798] \t\tatime 1764259517.0\n   [ 3845.737800] \t\tctime 1764259517.572889464\n   [ 3845.737801] \t\tmtime 1764259517.572889464\n   [ 3845.737802] \t\totime 1764259517.0\n   [ 3845.737803] \titem 1 key (256 INODE_REF 256) itemoff 16111 itemsize 12\n   [ 3845.737805] \t\tindex 0 name_len 2\n   [ 3845.737807] \titem 2 key (256 DIR_ITEM 2363071922) itemoff 16077 itemsize 34\n   [ 3845.737808] \t\tlocation key (257 1 0) type 2\n   [ 3845.737810] \t\ttransid 9 data_len 0 name_len 4\n   [ 3845.737811] \titem 3 key (256 DIR_ITEM 2676584006) itemoff 16043 itemsize 34\n   [ 3845.737813] \t\tlocation key (258 1 0) type 2\n   [ 3845.737814] \t\ttransid 9 data_len 0 name_len 4\n   [ 3845.737815] \titem 4 key (256 DIR_INDEX 2) itemoff 16009 itemsize 34\n   [ 3845.737816] \t\tlocation key (257 1 0) type 2\n   [\n---truncated---"
                }
            ],
            "affected": [
                {
                    "product": "Linux",
                    "vendor": "Linux",
                    "defaultStatus": "unaffected",
                    "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
                    "programFiles": [
                        "fs/btrfs/tree-log.c"
                    ],
                    "versions": [
                        {
                            "version": "44f714dae50a2e795d3268a6831762aa6fa54f55",
                            "lessThan": "d64f3834dffef80f0a9185a037617a54ed7f4bd2",
                            "status": "affected",
                            "versionType": "git"
                        },
                        {
                            "version": "44f714dae50a2e795d3268a6831762aa6fa54f55",
                            "lessThan": "7359e1d39c78816ecbdb0cb4e93975794ce53973",
                            "status": "affected",
                            "versionType": "git"
                        },
                        {
                            "version": "44f714dae50a2e795d3268a6831762aa6fa54f55",
                            "lessThan": "d478f50727c3ee46d0359f0d2ae114f70191816e",
                            "status": "affected",
                            "versionType": "git"
                        },
                        {
                            "version": "44f714dae50a2e795d3268a6831762aa6fa54f55",
                            "lessThan": "a35788ddf8df65837897ecbb0ddb2896b863159e",
                            "status": "affected",
                            "versionType": "git"
                        },
                        {
                            "version": "44f714dae50a2e795d3268a6831762aa6fa54f55",
                            "lessThan": "266273eaf4d99475f1ae57f687b3e42bc71ec6f0",
                            "status": "affected",
                            "versionType": "git"
                        }
                    ]
                },
                {
                    "product": "Linux",
                    "vendor": "Linux",
                    "defaultStatus": "affected",
                    "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
                    "programFiles": [
                        "fs/btrfs/tree-log.c"
                    ],
                    "versions": [
                        {
                            "version": "4.8",
                            "status": "affected"
                        },
                        {
                            "version": "0",
                            "lessThan": "4.8",
                            "status": "unaffected",
                            "versionType": "semver"
                        },
                        {
                            "version": "6.1.160",
                            "lessThanOrEqual": "6.1.*",
                            "status": "unaffected",
                            "versionType": "semver"
                        },
                        {
                            "version": "6.6.120",
                            "lessThanOrEqual": "6.6.*",
                            "status": "unaffected",
                            "versionType": "semver"
                        },
                        {
                            "version": "6.12.64",
                            "lessThanOrEqual": "6.12.*",
                            "status": "unaffected",
                            "versionType": "semver"
                        },
                        {
                            "version": "6.18.3",
                            "lessThanOrEqual": "6.18.*",
                            "status": "unaffected",
                            "versionType": "semver"
                        },
                        {
                            "version": "6.19",
                            "lessThanOrEqual": "*",
                            "status": "unaffected",
                            "versionType": "original_commit_for_fix"
                        }
                    ]
                }
            ],
            "cpeApplicability": [
                {
                    "nodes": [
                        {
                            "operator": "OR",
                            "negate": false,
                            "cpeMatch": [
                                {
                                    "vulnerable": true,
                                    "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                                    "versionStartIncluding": "4.8",
                                    "versionEndExcluding": "6.1.160"
                                },
                                {
                                    "vulnerable": true,
                                    "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                                    "versionStartIncluding": "4.8",
                                    "versionEndExcluding": "6.6.120"
                                },
                                {
                                    "vulnerable": true,
                                    "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                                    "versionStartIncluding": "4.8",
                                    "versionEndExcluding": "6.12.64"
                                },
                                {
                                    "vulnerable": true,
                                    "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                                    "versionStartIncluding": "4.8",
                                    "versionEndExcluding": "6.18.3"
                                },
                                {
                                    "vulnerable": true,
                                    "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                                    "versionStartIncluding": "4.8",
                                    "versionEndExcluding": "6.19"
                                }
                            ]
                        }
                    ]
                }
            ],
            "references": [
                {
                    "url": "https://git.kernel.org/stable/c/d64f3834dffef80f0a9185a037617a54ed7f4bd2"
                },
                {
                    "url": "https://git.kernel.org/stable/c/7359e1d39c78816ecbdb0cb4e93975794ce53973"
                },
                {
                    "url": "https://git.kernel.org/stable/c/d478f50727c3ee46d0359f0d2ae114f70191816e"
                },
                {
                    "url": "https://git.kernel.org/stable/c/a35788ddf8df65837897ecbb0ddb2896b863159e"
                },
                {
                    "url": "https://git.kernel.org/stable/c/266273eaf4d99475f1ae57f687b3e42bc71ec6f0"
                }
            ],
            "title": "btrfs: don't log conflicting inode if it's a dir moved in the current transaction",
            "x_generator": {
                "engine": "bippy-1.2.0"
            }
        }
    }
}