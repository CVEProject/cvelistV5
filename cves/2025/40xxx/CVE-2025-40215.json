{
    "dataType": "CVE_RECORD",
    "dataVersion": "5.2",
    "cveMetadata": {
        "cveId": "CVE-2025-40215",
        "assignerOrgId": "416baaa9-dc9f-4396-8d5f-8c081fb06d67",
        "state": "PUBLISHED",
        "assignerShortName": "Linux",
        "dateReserved": "2025-04-16T07:20:57.179Z",
        "datePublished": "2025-12-04T12:38:32.517Z",
        "dateUpdated": "2025-12-12T17:48:28.302Z"
    },
    "containers": {
        "cna": {
            "providerMetadata": {
                "orgId": "416baaa9-dc9f-4396-8d5f-8c081fb06d67",
                "shortName": "Linux",
                "dateUpdated": "2025-12-12T17:48:28.302Z"
            },
            "descriptions": [
                {
                    "lang": "en",
                    "value": "In the Linux kernel, the following vulnerability has been resolved:\n\nxfrm: delete x->tunnel as we delete x\n\nThe ipcomp fallback tunnels currently get deleted (from the various\nlists and hashtables) as the last user state that needed that fallback\nis destroyed (not deleted). If a reference to that user state still\nexists, the fallback state will remain on the hashtables/lists,\ntriggering the WARN in xfrm_state_fini. Because of those remaining\nreferences, the fix in commit f75a2804da39 (\"xfrm: destroy xfrm_state\nsynchronously on net exit path\") is not complete.\n\nWe recently fixed one such situation in TCP due to defered freeing of\nskbs (commit 9b6412e6979f (\"tcp: drop secpath at the same time as we\ncurrently drop dst\")). This can also happen due to IP reassembly: skbs\nwith a secpath remain on the reassembly queue until netns\ndestruction. If we can't guarantee that the queues are flushed by the\ntime xfrm_state_fini runs, there may still be references to a (user)\nxfrm_state, preventing the timely deletion of the corresponding\nfallback state.\n\nInstead of chasing each instance of skbs holding a secpath one by one,\nthis patch fixes the issue directly within xfrm, by deleting the\nfallback state as soon as the last user state depending on it has been\ndeleted. Destruction will still happen when the final reference is\ndropped.\n\nA separate lockdep class for the fallback state is required since\nwe're going to lock x->tunnel while x is locked."
                }
            ],
            "affected": [
                {
                    "product": "Linux",
                    "vendor": "Linux",
                    "defaultStatus": "unaffected",
                    "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
                    "programFiles": [
                        "include/net/xfrm.h",
                        "net/ipv4/ipcomp.c",
                        "net/ipv6/ipcomp6.c",
                        "net/ipv6/xfrm6_tunnel.c",
                        "net/xfrm/xfrm_ipcomp.c",
                        "net/xfrm/xfrm_state.c"
                    ],
                    "versions": [
                        {
                            "version": "9d4139c76905833afcb77fe8ccc17f302a0eb9ab",
                            "lessThan": "dc3636912d41770466543623cb76e7b88fdb42c7",
                            "status": "affected",
                            "versionType": "git"
                        },
                        {
                            "version": "9d4139c76905833afcb77fe8ccc17f302a0eb9ab",
                            "lessThan": "b441cf3f8c4b8576639d20c8eb4aa32917602ecd",
                            "status": "affected",
                            "versionType": "git"
                        }
                    ]
                },
                {
                    "product": "Linux",
                    "vendor": "Linux",
                    "defaultStatus": "affected",
                    "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
                    "programFiles": [
                        "include/net/xfrm.h",
                        "net/ipv4/ipcomp.c",
                        "net/ipv6/ipcomp6.c",
                        "net/ipv6/xfrm6_tunnel.c",
                        "net/xfrm/xfrm_ipcomp.c",
                        "net/xfrm/xfrm_state.c"
                    ],
                    "versions": [
                        {
                            "version": "2.6.29",
                            "status": "affected"
                        },
                        {
                            "version": "0",
                            "lessThan": "2.6.29",
                            "status": "unaffected",
                            "versionType": "semver"
                        },
                        {
                            "version": "6.12.62",
                            "lessThanOrEqual": "6.12.*",
                            "status": "unaffected",
                            "versionType": "semver"
                        },
                        {
                            "version": "6.16",
                            "lessThanOrEqual": "*",
                            "status": "unaffected",
                            "versionType": "original_commit_for_fix"
                        }
                    ]
                }
            ],
            "cpeApplicability": [
                {
                    "nodes": [
                        {
                            "operator": "OR",
                            "negate": false,
                            "cpeMatch": [
                                {
                                    "vulnerable": true,
                                    "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                                    "versionStartIncluding": "2.6.29",
                                    "versionEndExcluding": "6.12.62"
                                },
                                {
                                    "vulnerable": true,
                                    "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                                    "versionStartIncluding": "2.6.29",
                                    "versionEndExcluding": "6.16"
                                }
                            ]
                        }
                    ]
                }
            ],
            "references": [
                {
                    "url": "https://git.kernel.org/stable/c/dc3636912d41770466543623cb76e7b88fdb42c7"
                },
                {
                    "url": "https://git.kernel.org/stable/c/b441cf3f8c4b8576639d20c8eb4aa32917602ecd"
                }
            ],
            "title": "xfrm: delete x->tunnel as we delete x",
            "x_generator": {
                "engine": "bippy-1.2.0"
            }
        }
    }
}