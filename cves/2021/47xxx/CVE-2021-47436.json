{
    "dataType": "CVE_RECORD",
    "dataVersion": "5.1",
    "cveMetadata": {
        "cveId": "CVE-2021-47436",
        "assignerOrgId": "416baaa9-dc9f-4396-8d5f-8c081fb06d67",
        "state": "PUBLISHED",
        "assignerShortName": "Linux",
        "dateReserved": "2024-05-21T14:58:30.830Z",
        "datePublished": "2024-05-22T06:19:32.220Z",
        "dateUpdated": "2024-05-28T19:44:48.515Z"
    },
    "containers": {
        "cna": {
            "providerMetadata": {
                "orgId": "416baaa9-dc9f-4396-8d5f-8c081fb06d67",
                "shortName": "Linux",
                "dateUpdated": "2024-05-28T19:44:48.515Z"
            },
            "descriptions": [
                {
                    "lang": "en",
                    "value": "In the Linux kernel, the following vulnerability has been resolved:\n\nusb: musb: dsps: Fix the probe error path\n\nCommit 7c75bde329d7 (\"usb: musb: musb_dsps: request_irq() after\ninitializing musb\") has inverted the calls to\ndsps_setup_optional_vbus_irq() and dsps_create_musb_pdev() without\nupdating correctly the error path. dsps_create_musb_pdev() allocates and\nregisters a new platform device which must be unregistered and freed\nwith platform_device_unregister(), and this is missing upon\ndsps_setup_optional_vbus_irq() error.\n\nWhile on the master branch it seems not to trigger any issue, I observed\na kernel crash because of a NULL pointer dereference with a v5.10.70\nstable kernel where the patch mentioned above was backported. With this\nkernel version, -EPROBE_DEFER is returned the first time\ndsps_setup_optional_vbus_irq() is called which triggers the probe to\nerror out without unregistering the platform device. Unfortunately, on\nthe Beagle Bone Black Wireless, the platform device still living in the\nsystem is being used by the USB Ethernet gadget driver, which during the\nboot phase triggers the crash.\n\nMy limited knowledge of the musb world prevents me to revert this commit\nwhich was sent to silence a robot warning which, as far as I understand,\ndoes not make sense. The goal of this patch was to prevent an IRQ to\nfire before the platform device being registered. I think this cannot\never happen due to the fact that enabling the interrupts is done by the\n->enable() callback of the platform musb device, and this platform\ndevice must be already registered in order for the core or any other\nuser to use this callback.\n\nHence, I decided to fix the error path, which might prevent future\nerrors on mainline kernels while also fixing older ones."
                }
            ],
            "affected": [
                {
                    "product": "Linux",
                    "vendor": "Linux",
                    "defaultStatus": "unaffected",
                    "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
                    "programFiles": [
                        "drivers/usb/musb/musb_dsps.c"
                    ],
                    "versions": [
                        {
                            "version": "5269937d1483",
                            "lessThan": "5ed60a430fb5",
                            "status": "affected",
                            "versionType": "git"
                        },
                        {
                            "version": "ffc825049ed2",
                            "lessThan": "e923bce31ffe",
                            "status": "affected",
                            "versionType": "git"
                        },
                        {
                            "version": "9a4a6805294f",
                            "lessThan": "9ab5d539bc97",
                            "status": "affected",
                            "versionType": "git"
                        },
                        {
                            "version": "8de01a896c1b",
                            "lessThan": "9d89e2871167",
                            "status": "affected",
                            "versionType": "git"
                        },
                        {
                            "version": "72bb3eafcfdd",
                            "lessThan": "ff9249aab398",
                            "status": "affected",
                            "versionType": "git"
                        },
                        {
                            "version": "7c75bde329d7",
                            "lessThan": "c2115b2b1642",
                            "status": "affected",
                            "versionType": "git"
                        }
                    ]
                },
                {
                    "product": "Linux",
                    "vendor": "Linux",
                    "defaultStatus": "unaffected",
                    "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
                    "programFiles": [
                        "drivers/usb/musb/musb_dsps.c"
                    ],
                    "versions": [
                        {
                            "version": "4.14.247",
                            "lessThan": "4.14.252",
                            "status": "affected",
                            "versionType": "custom"
                        },
                        {
                            "version": "4.19.207",
                            "lessThan": "4.19.213",
                            "status": "affected",
                            "versionType": "custom"
                        },
                        {
                            "version": "5.4.148",
                            "lessThan": "5.4.155",
                            "status": "affected",
                            "versionType": "custom"
                        },
                        {
                            "version": "5.10.67",
                            "lessThan": "5.10.75",
                            "status": "affected",
                            "versionType": "custom"
                        },
                        {
                            "version": "5.14.6",
                            "lessThan": "5.14.14",
                            "status": "affected",
                            "versionType": "custom"
                        }
                    ]
                }
            ],
            "references": [
                {
                    "url": "https://git.kernel.org/stable/c/5ed60a430fb5f3d93e7fef66264daef466b4d10c"
                },
                {
                    "url": "https://git.kernel.org/stable/c/e923bce31ffefe4f60edfc6b84f62d4a858f3676"
                },
                {
                    "url": "https://git.kernel.org/stable/c/9ab5d539bc975b8dcde86eca1b58d836b657732e"
                },
                {
                    "url": "https://git.kernel.org/stable/c/9d89e287116796bf987cc48f5c8632ef3048f8eb"
                },
                {
                    "url": "https://git.kernel.org/stable/c/ff9249aab39820be11b6975a10d94253b7d426fc"
                },
                {
                    "url": "https://git.kernel.org/stable/c/c2115b2b16421d93d4993f3fe4c520e91d6fe801"
                }
            ],
            "title": "usb: musb: dsps: Fix the probe error path",
            "x_generator": {
                "engine": "bippy-a5840b7849dd"
            }
        }
    }
}