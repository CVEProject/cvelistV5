{
    "dataType": "CVE_RECORD",
    "dataVersion": "5.1",
    "cveMetadata": {
        "cveId": "CVE-2022-48838",
        "assignerOrgId": "416baaa9-dc9f-4396-8d5f-8c081fb06d67",
        "state": "PUBLISHED",
        "assignerShortName": "Linux",
        "dateReserved": "2024-07-16T11:38:08.907Z",
        "datePublished": "2024-07-16T12:25:09.859Z",
        "dateUpdated": "2024-07-16T12:25:09.859Z"
    },
    "containers": {
        "cna": {
            "providerMetadata": {
                "orgId": "416baaa9-dc9f-4396-8d5f-8c081fb06d67",
                "shortName": "Linux",
                "dateUpdated": "2024-07-16T12:25:09.859Z"
            },
            "descriptions": [
                {
                    "lang": "en",
                    "value": "In the Linux kernel, the following vulnerability has been resolved:\n\nusb: gadget: Fix use-after-free bug by not setting udc->dev.driver\n\nThe syzbot fuzzer found a use-after-free bug:\n\nBUG: KASAN: use-after-free in dev_uevent+0x712/0x780 drivers/base/core.c:2320\nRead of size 8 at addr ffff88802b934098 by task udevd/3689\n\nCPU: 2 PID: 3689 Comm: udevd Not tainted 5.17.0-rc4-syzkaller-00229-g4f12b742eb2b #0\nHardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS 1.14.0-2 04/01/2014\nCall Trace:\n <TASK>\n __dump_stack lib/dump_stack.c:88 [inline]\n dump_stack_lvl+0xcd/0x134 lib/dump_stack.c:106\n print_address_description.constprop.0.cold+0x8d/0x303 mm/kasan/report.c:255\n __kasan_report mm/kasan/report.c:442 [inline]\n kasan_report.cold+0x83/0xdf mm/kasan/report.c:459\n dev_uevent+0x712/0x780 drivers/base/core.c:2320\n uevent_show+0x1b8/0x380 drivers/base/core.c:2391\n dev_attr_show+0x4b/0x90 drivers/base/core.c:2094\n\nAlthough the bug manifested in the driver core, the real cause was a\nrace with the gadget core.  dev_uevent() does:\n\n\tif (dev->driver)\n\t\tadd_uevent_var(env, \"DRIVER=%s\", dev->driver->name);\n\nand between the test and the dereference of dev->driver, the gadget\ncore sets dev->driver to NULL.\n\nThe race wouldn't occur if the gadget core registered its devices on\na real bus, using the standard synchronization techniques of the\ndriver core.  However, it's not necessary to make such a large change\nin order to fix this bug; all we need to do is make sure that\nudc->dev.driver is always NULL.\n\nIn fact, there is no reason for udc->dev.driver ever to be set to\nanything, let alone to the value it currently gets: the address of the\ngadget's driver.  After all, a gadget driver only knows how to manage\na gadget, not how to manage a UDC.\n\nThis patch simply removes the statements in the gadget core that touch\nudc->dev.driver."
                }
            ],
            "affected": [
                {
                    "product": "Linux",
                    "vendor": "Linux",
                    "defaultStatus": "unaffected",
                    "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
                    "programFiles": [
                        "drivers/usb/gadget/udc/core.c"
                    ],
                    "versions": [
                        {
                            "version": "2ccea03a8f7e",
                            "lessThan": "4325124dde67",
                            "status": "affected",
                            "versionType": "git"
                        },
                        {
                            "version": "2ccea03a8f7e",
                            "lessThan": "e2d3a7009e50",
                            "status": "affected",
                            "versionType": "git"
                        },
                        {
                            "version": "2ccea03a8f7e",
                            "lessThan": "609a7119bffe",
                            "status": "affected",
                            "versionType": "git"
                        },
                        {
                            "version": "2ccea03a8f7e",
                            "lessThan": "2282a6eb6d4e",
                            "status": "affected",
                            "versionType": "git"
                        },
                        {
                            "version": "2ccea03a8f7e",
                            "lessThan": "00bdd9bf1ac6",
                            "status": "affected",
                            "versionType": "git"
                        },
                        {
                            "version": "2ccea03a8f7e",
                            "lessThan": "2015c23610cd",
                            "status": "affected",
                            "versionType": "git"
                        },
                        {
                            "version": "2ccea03a8f7e",
                            "lessThan": "27d64436984f",
                            "status": "affected",
                            "versionType": "git"
                        },
                        {
                            "version": "2ccea03a8f7e",
                            "lessThan": "16b1941eac2b",
                            "status": "affected",
                            "versionType": "git"
                        }
                    ]
                },
                {
                    "product": "Linux",
                    "vendor": "Linux",
                    "defaultStatus": "affected",
                    "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
                    "programFiles": [
                        "drivers/usb/gadget/udc/core.c"
                    ],
                    "versions": [
                        {
                            "version": "3.1",
                            "status": "affected"
                        },
                        {
                            "version": "0",
                            "lessThan": "3.1",
                            "status": "unaffected",
                            "versionType": "custom"
                        },
                        {
                            "version": "4.9.308",
                            "lessThanOrEqual": "4.9.*",
                            "status": "unaffected",
                            "versionType": "custom"
                        },
                        {
                            "version": "4.14.273",
                            "lessThanOrEqual": "4.14.*",
                            "status": "unaffected",
                            "versionType": "custom"
                        },
                        {
                            "version": "4.19.236",
                            "lessThanOrEqual": "4.19.*",
                            "status": "unaffected",
                            "versionType": "custom"
                        },
                        {
                            "version": "5.4.187",
                            "lessThanOrEqual": "5.4.*",
                            "status": "unaffected",
                            "versionType": "custom"
                        },
                        {
                            "version": "5.10.108",
                            "lessThanOrEqual": "5.10.*",
                            "status": "unaffected",
                            "versionType": "custom"
                        },
                        {
                            "version": "5.15.31",
                            "lessThanOrEqual": "5.15.*",
                            "status": "unaffected",
                            "versionType": "custom"
                        },
                        {
                            "version": "5.16.17",
                            "lessThanOrEqual": "5.16.*",
                            "status": "unaffected",
                            "versionType": "custom"
                        },
                        {
                            "version": "5.17",
                            "lessThanOrEqual": "*",
                            "status": "unaffected",
                            "versionType": "original_commit_for_fix"
                        }
                    ]
                }
            ],
            "references": [
                {
                    "url": "https://git.kernel.org/stable/c/4325124dde6726267813c736fee61226f1d38f0b"
                },
                {
                    "url": "https://git.kernel.org/stable/c/e2d3a7009e505e120805f449c832942660f3f7f3"
                },
                {
                    "url": "https://git.kernel.org/stable/c/609a7119bffe3ddd7c93f2fa65be8917e02a0b7e"
                },
                {
                    "url": "https://git.kernel.org/stable/c/2282a6eb6d4e118e294e43dcc421e0e0fe4040b5"
                },
                {
                    "url": "https://git.kernel.org/stable/c/00bdd9bf1ac6d401ad926d3d8df41b9f1399f646"
                },
                {
                    "url": "https://git.kernel.org/stable/c/2015c23610cd0efadaeca4d3a8d1dae9a45aa35a"
                },
                {
                    "url": "https://git.kernel.org/stable/c/27d64436984fb8835a8b7e95993193cc478b162e"
                },
                {
                    "url": "https://git.kernel.org/stable/c/16b1941eac2bd499f065a6739a40ce0011a3d740"
                }
            ],
            "title": "usb: gadget: Fix use-after-free bug by not setting udc->dev.driver",
            "x_generator": {
                "engine": "bippy-c9c4e1df01b2"
            }
        }
    }
}